{
  "$schema": "../node_modules/nx/schemas/project-schema.json",
  "name": "site",
  "root": "quartz",
  "sourceRoot": "quartz",
  "projectType": "application",
  "targets": {
    "clean": {
      "//": "Cleans quartz cache files",
      "executor": "nx:run-commands",
      "options": {
        "commands": [
          "rm -rf public",
          "rm -rf quartz/.quartz-cache"
        ],
        "cwd": "{workspaceRoot}",
        "parallel": true
      }
    },
    "_prebuild": {
      "//": "Internal target to run pre-build steps",
      "executor": "nx:run-commands",
      "options": {
        "commands": [
          "echo 'Pre-build steps complete!'"
        ],
        "cwd": "{workspaceRoot}",
        "parallel": false
      },
      "dependsOn": [
        "vault:download-annotation-pdfs"
      ]
    },
    "_postbuild": {
      "//": "Internal target to run post-build steps (copy robots.txt to root)",
      "executor": "nx:run-commands",
      "options": {
        "commands": [
          "cp quartz/static/robots.txt public/robots.txt"
        ],
        "cwd": "{workspaceRoot}",
        "parallel": false
      }
    },
    "serve": {
      "//": "Dev server with hot reload. Use serve:docs or serve:site for presets.",
      "executor": "nx:run-commands",
      "options": {
        "commands": [ "./quartz/bootstrap-cli.mjs build --serve -d {args.dir}" ],
        "parallel": false,
        "cwd": "{workspaceRoot}"
      },
      "configurations": {
        "docs": {
          "commands": [ "./quartz/bootstrap-cli.mjs build --serve -d docs/reference/external/quartz/repo/docs" ]
        },
        "site": {
          "commands": [ "./quartz/bootstrap-cli.mjs build --serve -d content/public" ]
        }
      },
      "defaultConfiguration": "site",
      "continuous": true,
      "dependsOn": [ "vault:sync", "site:_prebuild" ]
    },
    "build": {
      "//": "Production build to public/. Use build:docs or build:site for presets.",
      "executor": "nx:run-commands",
      "options": {
        "commands": [
          "./quartz/bootstrap-cli.mjs build -d {args.dir}",
          "cp quartz/static/robots.txt public/robots.txt"
        ],
        "parallel": false,
        "cwd": "{workspaceRoot}"
      },
      "configurations": {
        "docs": {
          "commands": [ "./quartz/bootstrap-cli.mjs build -d docs/reference/external/quartz/repo/docs" ]
        },
        "site": {
          "commands": [
            "./quartz/bootstrap-cli.mjs build -d content/public",
            "cp quartz/static/robots.txt public/robots.txt"
          ]
        }
      },
      "defaultConfiguration": "site",
      "outputs": [ "{workspaceRoot}/public" ],
      "dependsOn": [ "site:clean", "site:_prebuild" ]
    },
    "check": {
      "//": "Type checking and formatting validation",
      "executor": "nx:run-commands",
      "options": {
        "commands": [ "tsc --noEmit", "npx prettier . --check" ],
        "parallel": false,
        "cwd": "{workspaceRoot}"
      }
    },
    "format": {
      "//": "Auto-format codebase with Prettier",
      "executor": "nx:run-commands",
      "options": {
        "commands": [ "npx prettier . --write" ],
        "parallel": false,
        "cwd": "{workspaceRoot}"
      }
    },
    "test": {
      "//": "Run tests via tsx",
      "executor": "nx:run-commands",
      "options": {
        "commands": [ "tsx --test" ],
        "parallel": false,
        "cwd": "{workspaceRoot}"
      }
    },
    "eval": {
      "//": "Run Lighthouse audit on static build for performance evaluation, then extract actionable insights",
      "executor": "nx:run-commands",
      "options": {
        "commands": [
          "sleep 5",
          "lighthouse http://localhost:8080 --only-categories=performance,accessibility,best-practices,seo --output=html,json --output-path=./utils/lighthouse/raw/lighthouse-report.html",
          "node utils/lighthouse/extract-insights.mjs lighthouse-report"
        ],
        "parallel": false,
        "cwd": "{workspaceRoot}"
      },
      "dependsOn": [ "site:build", "_serve-static" ]
    },
    "_serve-static": {
      "//": "Helper: Serve production build from public/ directory on port 8080 for Lighthouse evaluation",
      "executor": "nx:run-commands",
      "options": {
        "commands": [
          "npx serve public -l 8080"
        ],
        "parallel": false,
        "cwd": "{workspaceRoot}"
      },
      "continuous": true,
      "outputs": [ "{workspaceRoot}/utils/lighthouse/assets/lighthouse-insights.json" ]
    },
    "eval:live": {
      "//": "Run Lighthouse audit on live site for remote server performance, then extract actionable insights",
      "executor": "nx:run-commands",
      "options": {
        "commands": [
          "lighthouse https://blog.chaoticgood.computer --only-categories=performance,accessibility,best-practices,seo --output=html,json --output-path=./utils/lighthouse/raw/lighthouse-report-live.html",
          "node utils/lighthouse/extract-insights.mjs lighthouse-report-live"
        ],
        "parallel": false,
        "cwd": "{workspaceRoot}"
      },
      "outputs": [ "{workspaceRoot}/utils/lighthouse/assets/lighthouse-insights-live.json" ]
    },
    "eval:multi": {
      "//": "Run Lighthouse CI on multiple pages from sitemap.",
      "executor": "nx:run-commands",
      "options": {
        "commands": [
          "sleep 5",
          "node utils/lighthouse/generate-urls-from-sitemap.mjs",
          "npx @lhci/cli@0.15.x autorun --config=utils/lighthouse/lighthouserc.cjs",
          "node utils/lighthouse/aggregate-multi-results.mjs"
        ],
        "parallel": false,
        "cwd": "{workspaceRoot}",
        "env": {
          "LHCI_MAX_URLS": "10",
          "LHCI_RUNS": "1"
        }
      },
      "outputs": [ "{workspaceRoot}/utils/lighthouse/assets/lighthouse-insights-multi.json" ],
      "dependsOn": [ "site:build", "_serve-static" ]
    }
  }
}
