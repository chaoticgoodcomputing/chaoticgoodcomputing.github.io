{
  "$schema": "../node_modules/nx/schemas/project-schema.json",
  "name": "site",
  "root": "quartz",
  "sourceRoot": "quartz",
  "projectType": "application",
  "targets": {
    "clean": {
      "//": "Cleans quartz cache files and output directory",
      "executor": "nx:run-commands",
      "options": {
        "commands": [
          "rm -rf public",
          "rm -rf quartz/.quartz-cache"
        ],
        "cwd": "{workspaceRoot}",
        "parallel": true
      }
    },
    "_prepare-fonts": {
      "//": "Downloads and prepares self-hosted Google Fonts with optional subsetting",
      "executor": "nx:run-commands",
      "options": {
        "commands": [
          "node utils/fonts/download-fonts.mjs"
        ],
        "cwd": "{workspaceRoot}",
        "parallel": false
      },
      "outputs": [ "{workspaceRoot}/quartz/static/fonts/" ],
      "dependsOn": [ "site:clean" ]
    },
    "_subset-fonts": {
      "//": "Subsets fonts to only characters used on site (requires glyphhanger and completed build)",
      "executor": "nx:run-commands",
      "options": {
        "commands": [
          "node utils/fonts/subset-fonts.mjs"
        ],
        "cwd": "{workspaceRoot}",
        "parallel": false
      }
    },
    "_prebuild": {
      "//": "Private target for pre-build hooks. Clean runs first via deps, then parallel prep.",
      "executor": "nx:run-commands",
      "options": {
        "commands": [ ],
        "parallel": false
      },
      "dependsOn": [
        "site:_prepare-fonts",
        "vault:download-annotation-pdfs"
      ]
    },
    "_inbuild": {
      "//": "Private target for the actual build execution. Runs Quartz build command.",
      "executor": "nx:run-commands",
      "options": {
        "commands": [
          "./quartz/bootstrap-cli.mjs build -d content/public"
        ],
        "cwd": "{workspaceRoot}",
        "parallel": false
      },
      "outputs": [ "{workspaceRoot}/public" ]
    },
    "_postbuild": {
      "//": "Private target for post-build hooks. Uses dependsOn for extensibility.",
      "executor": "nx:run-commands",
      "options": {
        "commands": [
          "cp quartz/static/robots.txt public/robots.txt",
          "cp CNAME public/CNAME"
        ],
        "cwd": "{workspaceRoot}",
        "parallel": false
      }
    },
    "serve": {
      "//": "Dev server with hot reload",
      "executor": "nx:run-commands",
      "options": {
        "commands": [ "./quartz/bootstrap-cli.mjs build --serve -d content/public" ],
        "parallel": false,
        "cwd": "{workspaceRoot}"
      },
      "continuous": true,
      "dependsOn": [ "site:clean", "vault:sync", "site:_prebuild" ]
    },
    "build": {
      "//": "Public build target. Orchestrates _prebuild → _inbuild → _postbuild sequence.",
      "executor": "nx:run-commands",
      "options": {
        "commands": [
          "nx run site:_inbuild",
          "nx run site:_postbuild"
        ],
        "parallel": false,
        "cwd": "{workspaceRoot}"
      },
      "outputs": [ "{workspaceRoot}/public" ],
      "dependsOn": [ "site:_prebuild" ]
    },
    "check": {
      "//": "Type checking and formatting validation",
      "executor": "nx:run-commands",
      "options": {
        "commands": [ "tsc --noEmit", "npx prettier . --check" ],
        "parallel": false,
        "cwd": "{workspaceRoot}"
      }
    },
    "format": {
      "//": "Auto-format codebase with Prettier",
      "executor": "nx:run-commands",
      "options": {
        "commands": [ "npx prettier . --write" ],
        "parallel": false,
        "cwd": "{workspaceRoot}"
      }
    },
    "test": {
      "//": "Run tests via tsx",
      "executor": "nx:run-commands",
      "options": {
        "commands": [ "tsx --test" ],
        "parallel": false,
        "cwd": "{workspaceRoot}"
      }
    },
    "eval": {
      "//": "Run Lighthouse audit on static build for performance evaluation, then extract actionable insights",
      "executor": "nx:run-commands",
      "options": {
        "commands": [
          "sleep 5",
          "lighthouse http://localhost:8080 --only-categories=performance,accessibility,best-practices,seo --output=html,json --output-path=./utils/lighthouse/raw/lighthouse-report.html",
          "node utils/lighthouse/extract-insights.mjs lighthouse-report"
        ],
        "parallel": false,
        "cwd": "{workspaceRoot}"
      },
      "dependsOn": [ "site:build", "_serve-static" ]
    },
    "_serve-static": {
      "//": "Helper: Serve production build from public/ directory on port 8080 for Lighthouse evaluation",
      "executor": "nx:run-commands",
      "options": {
        "commands": [
          "npx serve public -l 8080"
        ],
        "parallel": false,
        "cwd": "{workspaceRoot}"
      },
      "continuous": true,
      "outputs": [ "{workspaceRoot}/utils/lighthouse/assets/lighthouse-insights.json" ]
    },
    "eval:live": {
      "//": "Run Lighthouse audit on live site for remote server performance, then extract actionable insights",
      "executor": "nx:run-commands",
      "options": {
        "commands": [
          "lighthouse https://blog.chaoticgood.computer --only-categories=performance,accessibility,best-practices,seo --output=html,json --output-path=./utils/lighthouse/raw/lighthouse-report-live.html",
          "node utils/lighthouse/extract-insights.mjs lighthouse-report-live"
        ],
        "parallel": false,
        "cwd": "{workspaceRoot}"
      },
      "outputs": [ "{workspaceRoot}/utils/lighthouse/assets/lighthouse-insights-live.json" ]
    },
    "eval:multi": {
      "//": "Run Lighthouse CI on multiple pages from sitemap.",
      "executor": "nx:run-commands",
      "options": {
        "commands": [
          "sleep 5",
          "node utils/lighthouse/generate-urls-from-sitemap.mjs",
          "npx @lhci/cli@0.15.x autorun --config=utils/lighthouse/lighthouserc.cjs",
          "node utils/lighthouse/aggregate-multi-results.mjs"
        ],
        "parallel": false,
        "cwd": "{workspaceRoot}",
        "env": {
          "LHCI_MAX_URLS": "20",
          "LHCI_RUNS": "3"
        }
      },
      "outputs": [ "{workspaceRoot}/utils/lighthouse/assets/lighthouse-insights-multi.json" ],
      "dependsOn": [ "site:build", "_serve-static" ]
    }
  }
}
