#!/bin/bash
# Post-push hook: Update submodule reference after pushing if it changed

# Unset git environment variables
unset GIT_DIR
unset GIT_WORK_TREE
unset GIT_INDEX_FILE

SUBMODULE_PATH="content/private"

# Check if submodule reference has changed
if [ -d "$SUBMODULE_PATH" ] && [ -e "$SUBMODULE_PATH/.git" ]; then
  # Check if the submodule is in a different state than what's committed
  if ! git diff --quiet --cached -- "$SUBMODULE_PATH" 2>/dev/null && \
     ! git diff --quiet -- "$SUBMODULE_PATH" 2>/dev/null; then
    
    # Submodule reference differs from what's committed
    git add "$SUBMODULE_PATH" 2>/dev/null
    
    if ! git diff --quiet --cached -- "$SUBMODULE_PATH" 2>/dev/null; then
      echo ""
      echo "ðŸ“Œ Updating submodule reference after push..."
      
      git commit -m "Update private submodule reference" 2>/dev/null && \
      git push 2>/dev/null && \
      echo "âœ“ Submodule reference updated and pushed"
    fi
  fi
fi

exit 0
