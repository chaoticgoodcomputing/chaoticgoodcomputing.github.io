#!/bin/bash
# Pre-push hook: Push private submodule changes before pushing main repo

source "$(dirname "$0")/submodule-helpers.sh"

# Check if submodule has unpushed commits
if [ -d "$SUBMODULE_PATH" ] && [ -e "$SUBMODULE_PATH/.git" ]; then
  # Check for unpushed commits in a subshell
  HAS_UNPUSHED=$(
    cd "$SUBMODULE_PATH" 2>/dev/null || exit 0
    LOCAL=$(git rev-parse @ 2>/dev/null)
    REMOTE=$(git rev-parse @{u} 2>/dev/null)
    
    if [ "$LOCAL" != "$REMOTE" ] && [ -n "$LOCAL" ] && [ -n "$REMOTE" ]; then
      echo "yes"
    fi
  )
  
  if [ "$HAS_UNPUSHED" = "yes" ]; then
    echo ""
    echo "ðŸš€ Pushing $SUBMODULE_NAME changes first..."
    
    safe_submodule_exec "push" "git push"
    
    echo ""
  fi
fi

exit 0
