#!/bin/bash
# Post-commit hook: Automatically commit changes in private submodule

source "$(dirname "$0")/submodule-helpers.sh"

# Check if there are any changes in the submodule
if [ -d "$SUBMODULE_PATH" ] && [ -e "$SUBMODULE_PATH/.git" ]; then
  # Check for changes in a subshell
  HAS_CHANGES=$(
    cd "$SUBMODULE_PATH" 2>/dev/null || exit 0
    if ! git diff --quiet 2>/dev/null || ! git diff --cached --quiet 2>/dev/null || [ -n "$(git ls-files --others --exclude-standard 2>/dev/null)" ]; then
      echo "yes"
    fi
  )
  
  if [ "$HAS_CHANGES" = "yes" ]; then
    echo ""
    echo "üìù Detected changes in $SUBMODULE_NAME..."
    
    # Get the commit message from the main repo
    MAIN_COMMIT_MSG=$(git log -1 --pretty=%B)
    
    safe_submodule_exec "commit" "git add -A && git commit -m 'Sync: $MAIN_COMMIT_MSG'"
    
    echo ""
    echo "üí° Tip: Changes in $SUBMODULE_NAME are committed but not pushed."
    echo "   Run 'git push' to sync both repositories."
  fi
fi

exit 0
